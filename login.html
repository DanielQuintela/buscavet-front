<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Login</title>
    <link rel="stylesheet" href="css/loginUser.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <div class="content first-content">
            <div class="first-column">
                <h2 class="title title-primary">Seja Bem vindo</h2>
                <p class="description description-primary">Se você já tiver cadastro </p>
                <p class="description description-primary">Em nosso site, clique em "Não tem conta? Cadastre Agora!"</p>
                <a href="cadastroUser.html"><button id="signin" class="btn btn-primary">Criar conta</button> </a>
                <p class="description description-primary">Você é Veterinário e não tem conta?"Crie uma conta Veterinário"</p>

                <a href="cadastroVet.html"><button id="signin" class="btn btn-primary">Criar conta Veterinário</button> </a>
            </div>
            <div class="second-column">
                <img src="img/logo.png" width="250">
                <h2 class="title title-second">Faça seu login aqui</h2>
                <div class="social-media">
                    <ul class="list-social-media">
                        <a class="link-social-media" href="#">
                            <li class="item-social-media">
                                <i class="fab fa-facebook-f"></i>
                            </li>
                        </a>
                        <a class="link-social-media" href="#">
                            <li class="item-social-media">
                                <i class="fab fa-google-plus-g"></i>
                            </li>
                        </a>
                        <a class="link-social-media" href="#">
                            <li class="item-social-media">
                                <i class="fab fa-linkedin-in"></i>
                            </li>
                        </a>
                    </ul>
                </div>
                <!-- social media -->
                <p class="description description-second">ou use seu e-mail para se registrar:</p>
                <form class="form">
                    <label class="label-input">
                        <i class="far fa-envelope icon-modify"></i>
                        <input type="email" placeholder="Email" required id ="email">
                    </label>
                    <label class="label-input">
                        <i class="fas fa-lock icon-modify"></i>
                        <input type="password" placeholder="Password" required id ="senha">
                    </label>
                </form>
                <div id="error-message" class="error-message"></div>
                <button class="btn btn-second" id="btn-entrar">Entrar</button>
                <p class="description description-second">Esqueceu a senha?</p>
                <a href="#"> <button class="btn btn-second">Recuperar senha</button></a>
                <div id="error-message" class="error-message"></div>
                <script>
                    document.addEventListener('DOMContentLoaded', () => {
                        document.getElementById('btn-entrar').addEventListener('click', async () => {
                            try {
                                const email = document.getElementById('email').value;
                                const senha = document.getElementById('senha').value;

                                const requestOptions = {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify({
                                        email,
                                        senha,
                                    }),
                                };
                                const res = await fetch('http://localhost:4000/usuarios/login', requestOptions);
                                
                                if (res.status === 200) {
                                    const data = await res.json();
                                    const token = data.token;
                                    localStorage.setItem('token', token);
                                    window.location.href = 'infoUser.html'
                                } else {
                                    document.getElementById('error-message').textContent = 'Email ou Senha incorreto(s)';
                                }
                            }
                            catch (error) {
                                document.getElementById('error-message').textContent = 'Erro ao fazer login';
                            }
                        })
                    })
                </script>
            </div>
        </div>
    </div>
</body>

</html>